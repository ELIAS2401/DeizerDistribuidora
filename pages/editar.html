<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Productos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        h1 {
            text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            background: white;
        }

        th,
        td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        th {
            background: #ddd;
        }

        input,
        select,
        button {
            padding: 6px;
            margin: 4px;
        }

        #acciones {
            margin-bottom: 10px;
            text-align: center;
        }

        button {
            cursor: pointer;
            border-radius: 5px;
            border: none;
        }

        button:hover {
            opacity: 0.9;
        }

        .btn-guardar {
            background: #4CAF50;
            color: white;
        }

        .btn-agregar {
            background: #2196F3;
            color: white;
        }

        .btn-eliminar {
            background: #f44336;
            color: white;
        }
    </style>
</head>

<body>

    <h1>üõ†Ô∏è Editor de Productos JSON</h1>

    <div id="acciones">
        <input type="file" id="fileInput" accept=".json">
        <button class="btn-agregar" onclick="agregarFila()">‚ûï Agregar producto</button>
        <button class="btn-guardar" onclick="descargarJSON()">üíæ Descargar JSON</button>
    </div>

    <table id="tabla">
        <thead>
            <tr>
                <th>Id</th>
                <th>Producto</th>
                <th>Tipo</th>
                <th>Precio</th>
                <th>PrecioConDescuento</th>
                <th>PrecioUnidadxBulto</th>
                <th>PrecioTotalBulto</th>
                <th>UnidadesPorBulto</th>
                <th>Categor√≠a</th>
                <th>Notas</th>
                <th>Img</th>
                <th>Descripci√≥n</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        let productos = [];

        // Cargar JSON desde archivo
        document.getElementById("fileInput").addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                try {
                    productos = JSON.parse(ev.target.result);
                    renderTabla();
                } catch {
                    alert("Error al leer el JSON");
                }
            };
            reader.readAsText(file);
        });

        // Mostrar tabla
        function renderTabla() {
            const tbody = document.querySelector("#tabla tbody");
            tbody.innerHTML = "";
            productos.forEach((p, i) => {
                const fila = document.createElement("tr");
                fila.innerHTML = `
      <td contenteditable>${p.Id ?? ""}</td>
      <td contenteditable>${p.Producto ?? ""}</td>
      <td contenteditable>${p.Tipo ?? ""}</td>
      <td contenteditable>${p.Precio ?? ""}</td>
      <td contenteditable>${p.PrecioConDescuento ?? ""}</td>
      <td contenteditable>${p.PrecioUnidadxBulto ?? ""}</td>
      <td contenteditable>${p.PrecioTotalBulto ?? ""}</td>
      <td contenteditable>${p.UnidadesPorBulto ?? ""}</td>
      <td contenteditable>${p.Categor√≠a ?? ""}</td>
      <td contenteditable>${p.Notas ?? ""}</td>
      <td contenteditable>${p.Img ?? ""}</td>
      <td contenteditable>${p.Descripci√≥n ?? ""}</td>

      <td><button class="btn-eliminar" onclick="eliminarFila(${i})">üóëÔ∏è</button></td>
    `;
                tbody.appendChild(fila);
            });
        }

        // Agregar producto nuevo
        function agregarFila() {
            productos.push({ Id: "", Producto: "", Tipo: "", Precio: "", Categor√≠a: "" });
            renderTabla();
        }

        // Eliminar producto
        function eliminarFila(index) {
            productos.splice(index, 1);
            renderTabla();
        }

        // Descargar JSON actualizado
        function descargarJSON() {
            const filas = document.querySelectorAll("#tabla tbody tr");
            const nuevosDatos = Array.from(filas).map(f => {
                const c = f.querySelectorAll("td");
                return {
                    Id: parseInt(c[0].innerText) || "",
                    Producto: c[1].innerText.trim(),
                    Tipo: c[2].innerText.trim(),
                    Precio: c[3].innerText.trim(),
                    Categor√≠a: c[4].innerText.trim(),
                    Descripci√≥n: c[5].innerText.trim(),
                    Img: c[6].innerText.trim(),
                    Unidades: c[7].innerText.trim(),
                    PrecioTotal: c[8].innerText.trim()
                };
            });
            const blob = new Blob([JSON.stringify(nuevosDatos, null, 4)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "productos_actualizado.json";
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>

</html>